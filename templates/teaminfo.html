<!DOCTYPE html>
<!--  This site was created in Webflow. http://www.webflow.com  -->
<!--  Last Published: Mon Jul 06 2020 16:48:25 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="5ec3fd4e94246777ae971499" data-wf-site="5ec2ba8457c5c50b20b387c9">
{% include 'header.html' %}
<body class="body-3">
 {% include 'navbar.html' %}
  <div class="centered-container w-container">
    <div class="text-block-5">Team info: {{escape(current_team['name'])}}</div>
    <div data-duration-in="300" data-duration-out="100" class="tabs w-tabs">
      <div class="w-tab-menu">
        <a data-w-tab="Tab 1" class="w-inline-block w-tab-link">
          <div>About</div>
        </a>
        <a data-w-tab="Tab 2" class="w-inline-block w-tab-link">
          <div>Testers</div>
        </a>
        <a data-w-tab="Tab 3" class="w-inline-block w-tab-link w--current">
          <div>Administrators</div>
        </a>
        <a data-w-tab="Tab 4" class="w-inline-block w-tab-link">
          <div>Projects</div>
        </a>
        <a data-w-tab="Tab 5" class="w-inline-block w-tab-link">
          <div>Logs</div>
        </a>
      </div>
      <div class="w-tab-content">
        <div data-w-tab="Tab 1" class="w-tab-pane">
          <div class="w-form">
            <form id="email-form" name="email-form" data-name="Email Form" class="w-clearfix" method="post" action="/team/{{escape(current_team['id'])}}/">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
              <input type="hidden" name="change_info" value="1"/>
              <label for="name" class="field-label-6">Team name:</label>
              <input type="text" class="w-input" maxlength="256" name="name" data-name="Name" placeholder="Redteam" id="name" value="{{ escape(current_team['name']) }}">
              <label for="email" class="field-label-7">Creator/Main admin email (change careful!):</label>
              <input type="email" class="w-input" maxlength="256" name="email" data-name="Email" placeholder="drakylar@yandex.ru" id="email" required="" value="{{ escape(current_team['admin_email']) }}">
              <label for="Description" class="field-label-8">Description:</label>
              <textarea placeholder="Internal security team" maxlength="5000" id="Description" name="description" data-name="Description" class="w-input">{{ escape(current_team['description']) }}</textarea>
              <input type="submit" value="Submit" data-wait="Please wait..." class="submit-button-2 w-button">
            </form>

            {% if team_info_errors is defined %}
                {% for error in team_info_errors %}
                    <div class="w-form-fail" style="display: block">
                        <div>{{error}}</div>
                    </div>
                {% else %}
                    <div class="w-form-done" style="display: block">
                        <div>Team information was updated!</div>
                    </div>
                {% endfor %}
            {% endif %}
          </div>
        </div>
        <div data-w-tab="Tab 2" class="w-tab-pane">
          {% set count = [1] %}
          {% for user_id in json_unpack(current_team['users']) %}
              {% set curr_tester = json_unpack(current_team['users'])[user_id] %}
              {% if curr_tester=='tester' %}
                  {% set user_data = db.select_user_by_id(user_id)[0] %}
                  {% if count.append(count.pop() + 1) %} {% endif %}
                  {% if count[0] % 2 == 0 %}
                    <div class="tester1 w-clearfix" a="{{count}}">
                  {% else %}
                    <div class="tester2 w-clearfix">
                  {% endif %}
                    <div class="text-block-6">{{escape(user_data['fname'] + ' ' + user_data['lname'] + ' - ' + user_data['email'])}}</div>
                    <form method="post" action="user/{{user_data['id']}}/kick">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <button type="submit" class="button w-button">Kick</button>
                    </form>
                    <form method="post" action="user/{{user_data['id']}}/set_admin">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <button type="submit" class="devotebutton w-button">Set admin</button>
                    </form>
                    <a href="/profile/{{user_data['id']}}/" class="profilebutton w-button">Profile</a>
                  </div>
              {% endif %}
          {% endfor %}
          <div class="w-form">
            <form id="email-form-2" name="email-form-2" data-name="Email Form 2" class="w-clearfix" action="/team/{{escape(current_team['id'])}}/" method="post">
              <label for="TesterName" class="field-label-9">Add new tester:</label>
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
              <input type="hidden" name="add_user" value="1"/>
              <input type="hidden" name="role" value="tester"/>
              <input type="email" class="w-input" maxlength="256" name="email" data-name="TesterName" placeholder="test@example.com" id="TesterName">
              <input type="submit" value="Submit" data-wait="Please wait..." class="submit-button-3 w-button">
            </form>
            {% if add_tester_errors is defined %}
                {% for error in add_tester_errors %}
                    <div class="w-form-fail" style="display: block">
                        <div>{{error}}</div>
                    </div>
                {% endfor %}
            {% endif %}
          </div>
        </div>
        <div data-w-tab="Tab 3" class="w-tab-pane w--tab-active">
          {% set count = [1] %}
          {% for user_id in json_unpack(current_team['users']) %}
              {% set curr_tester = json_unpack(current_team['users'])[user_id] %}
              {% if curr_tester=='admin' %}
                  {% set user_data = db.select_user_by_id(user_id)[0] %}
                  {% if count.append(count.pop() + 1) %} {% endif %}
                  {% if count[0] % 2 == 0 %}
                    <div class="tester1 w-clearfix">
                  {% else %}
                    <div class="tester2 w-clearfix">
                  {% endif %}
                    <div class="text-block-6">{{escape(user_data['fname'] + ' ' + user_data['lname'] + ' - ' + user_data['email'])}}</div>
                    <form method="post" action="user/{{user_data['id']}}/kick">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <button type="submit" class="button w-button">Kick</button>
                    </form>
                    <form method="post" action="user/{{user_data['id']}}/devote">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <button type="submit" class="devotebutton w-button">Devote</button>
                    </form>
                    <a href="/profile/{{user_data['id']}}/" class="profilebutton w-button">Profile</a>
                  </div>
              {% endif %}
          {% endfor %}

          <div class="w-form">
            <form id="email-form-3" name="email-form-3" data-name="Email Form 3" class="form-2 w-clearfix" method="post" action="/team/{{escape(current_team['id'])}}/">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
              <input type="hidden" name="add_user" value="1"/>
              <input type="hidden" name="role" value="admin"/>
              <label for="NewAdmin" class="field-label-10">Add a new admin:</label>
              <input type="email" class="w-input" maxlength="256" name="email" data-name="NewAdmin" placeholder="admin@example.com" id="NewAdmin">
              <input type="submit" value="Submit" data-wait="Please wait..." class="submit-button-4 w-button">
            </form>
            {% if add_admin_errors is defined %}
                {% for error in add_admin_errors %}
                    <div class="w-form-fail" style="display: block">
                        <div>{{error}}</div>
                    </div>
                {% endfor %}
            {% endif %}
          </div>
        </div>
        <div data-w-tab="Tab 4" class="w-clearfix w-tab-pane">
          <div class="text-block-5">Active projects:</div>
            {% set projects = db.select_team_projects(current_team['id']) %}
            {% set count = [1] %}
            {% for project in projects %}
                {% if project['status']==1 %}
                      {% if not (project['auto_archive']==1 and project['end_date']< time()) %}
                          {% if count.append(count.pop() + 1) %} {% endif %}
                          {% if (count[0] % 2 == 0) %}
                          <div class="tester1 w-clearfix">
                          {% else %}
                          <div class="tester2 w-clearfix">
                          {% endif %}
                              <div class="text-block-6">{{escape(project['name'])}}</div>
                              <form method="post" action="/project/{{project['id']}}/settings/">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                    <button type="submit" name="action" value="Archive" class="button w-button">Archive</button>
                              </form>
                              <a href="/project/{{project['id']}}/" class="devotebutton w-button">Open</a>
                          </div>
                      {% endif %}
                {% endif %}
            {% endfor %}

            <a href="/new_project?team_id={{current_team['id']}}" class="button-2 w-button">Add new</a>


            <div class="text-block-5">Archived projects:</div>
            {% set count = [1] %}
            {% for project in projects %}
                {% if project['status']==0 or (project['auto_archive']==1 and project['end_date']< time()) %}
                          {% if count.append(count.pop() + 1) %} {% endif %}
                          {% if (count[0] % 2 == 0) %}
                          <div class="tester1 w-clearfix">
                          {% else %}
                          <div class="tester2 w-clearfix">
                          {% endif %}
                              <div class="text-block-6">{{escape(project['name'])}}</div>
                              <a href="/project/{{project['id']}}/reports/" class="button w-button">Reports</a>
                              <form method="post" action="/project/{{project['id']}}/settings/">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                    <button type="submit" name="action" value="Activate" class="devotebutton w-button">Activate</button>
                              </form>
                          </div>
                {% endif %}
            {% endfor %}
        </div>
        <div data-w-tab="Tab 5" class="w-tab-pane">
          <div class="w-form">
            <form id="email-form-4" name="email-form-4" data-name="Email Form 4">
                <textarea placeholder="10-02-2018 20:00 Project: testing1 User:drakylar@yandex.ru -- Added new ports" maxlength="5000" id="Logs" name="Logs" data-name="Logs" class="w-input textarea-9">
{% set log_dict = db.get_log_by_team_id(current_team['id']) %}{% for row in log_dict %}{{ format_date(row['date'],'%d-%m-%Y %H:%M:%S') }} - Project: {{ escape(row['project']) }} User: {{ escape(db.select_user_by_id(row['user_id'])[0]['email']) }} -- {{ escape(row['description']) }}
{% endfor %}</textarea>
            </form>
            <div class="w-form-done">
              <div>Thank you! Your submission has been received!</div>
            </div>
            <div class="w-form-fail">
              <div>Oops! Something went wrong while submitting the form.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% if (edit_error is defined) and (edit_error != None) and (edit_error != '')  %}
        <div class="w-form-fail" style="display: block">
            <div>{{escape(edit_error)}}</div>
        </div>
    {% endif %}
  </div>
{% include 'footer.html' %}
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>
  $('#StartTime').datepicker();
  $('#EndTime').datepicker();
  </script>
</body>
</html>