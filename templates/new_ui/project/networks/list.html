<!DOCTYPE html>
<html lang="en">
{% include 'new_ui/header.html' %}
<body>
{% include 'new_ui/menu.html' %}
<div class="ui grid">
    <div class="ui column" style="width: 75px; padding-top: 50px;">
        {% include 'new_ui/project/sidebar.html' %}
    </div>
    {% set networks=db.select_project_networks(current_project['id']) %}
    <script>
        $(document).ready(function () {
            $('.menu .item')
                .tab({
                    history: true
                });
            $('#example').DataTable({
                'columnDefs': [{
                    'targets': 6,
                    'searchable': false,
                    'orderable': false,
                }]
            });
        });
    </script>
    <style>
        tbody tr.odd {
            background-color: #fffdc2;
        }

        tbody tr.even {
            background-color: #c3ffcd;
        }

        .ui.menu:last-child {
            margin-bottom: 0px;
        }


    </style>
    <div class="ui column" style="width: calc(100% - 75px)">
        <div class="ui top attached tabular menu">
            <div class="active item" data-tab="list"><i class="list icon"></i>Networks list</div>
            <div class="item" data-tab="graph"><i class="share alternate icon"></i>Networks graph</div>
        </div>
        <div class="ui bottom attached active tab segment" data-tab="list">
            <div style="float:left; width: 100%">
                <h1 class="ui header" style="float: left;">Networks: {{ len(networks) }}</h1>
                <a class="ui button purple" style="float: right"
                   href="/project/{{ current_project['id'] }}/networks/new_network"><i class="plus icon"></i>Add</a>
            </div>
            <table id="example" class="ui table" width="100%">
                <thead>
                <tr>
                    <th>Network</th>
                    <th>Access from</th>
                    <th>Internal IP</th>
                    <th>Connect command</th>
                    <th>Comment</th>
                    <th>ASN</th>
                    <th style="width: 90px;">Action</th>
                </tr>
                </thead>
                <tbody>
                {% for network in networks %}
                    <tr>
                        <td style="word-break: break-all;">
                            <div class="text-block-20">{{ escape(network['ip']) }}/{{ escape(network['mask']) }}</div>
                        </td>
                        <td style="word-break: break-all;">
                            {% set addresses = json_unpack(network['access_from']) %}
                            {% set counter = [0] %}
                            {% for port_id in addresses %}
                                {% set port = db.select_port(port_id)[0] %}
                                {% for host in addresses[port_id] %}
                                    <ul class="ui list">
                                        {% if counter[0] < 5 %}
                                            {% if host=="0" %}
                                                {% set ip = db.select_host_by_port_id(port_id)[0] %}
                                                <li>
                                                    <a href="/project/{{ current_project['id'] }}/host/{{ port['host_id'] }}/">
                                                        {{ escape(ip['ip']) }}{% if port['port'] != 0 %}:
                                                            {{ escape(port['port']) }}{% endif %}</a>
                                                </li>
                                            {% else %}
                                                {% set hostname = db.select_hostname(host)[0] %}
                                                <li>
                                                    {{ escape(hostname['hostname']) }}{% if port['port'] != 0 %}:
                                                        {{ escape(port['port']) }}{% endif %}</li>
                                            {% endif %}
                                        {% endif %}
                                        {% if counter.append(counter.pop() + 1) %}{% endif %}
                                    </ul>
                                {% endfor %}
                            {% endfor %}
                            {% if counter[0] >5 %}
                                <div class="text-block-26"> ...</div>
                                <div class="text-block-26"> {{ counter[0] }} hosts at all!</div>
                            {% endif %}
                        </td>
                        <td style="word-break: break-all;">
                            <div class="text-block-20">{{ escape(network['internal_ip']) }}</div>
                        </td>
                        <td style="word-break: break-all;">
                            <div class="text-block-20"
                                 style="word-break: break-all; white-space:pre-wrap;">{{ escape(network['cmd']) }}</div>
                        </td>
                        <td style="word-break: break-all;">
                            <div class="text-block-22"
                                 style="word-break: break-all; white-space:pre-wrap;">{{ escape(network['comment']) }}</div>
                        </td>
                        <td style="word-break: break-all;">
                            {% if network['asn'] != 0 and network['asn'] != None %}
                                <div class="text-block-22">ASN{{ escape(network['asn']) }} <a
                                        href="https://ipinfo.io/AS{{ network['asn'] }}">(ipinfo)</a> <a
                                        href="https://bgp.he.net/AS{{ network['asn'] }}">(bgp)</a></div>
                            {% endif %}
                        </td>
                        <td style="float:left;">
                            <a class="ui icon blue button"
                               href="/project/{{ current_project['id'] }}/hosts/?network={{ network['id'] }}">
                                <i class="ui search icon"></i>
                            </a>

                            <a class="ui icon purple button"
                               href="/project/{{ current_project['id'] }}/networks/{{ network['id'] }}/">
                                <i class="ui edit outline icon"></i></a>
                            </a>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="ui bottom attached tab segment" data-tab="graph">
            <p>1234</p>
            <p></p>
        </div>
    </div>
    {% include 'new_ui/footer.html' %}
</div>
</body>
</html>