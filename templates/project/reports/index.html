<!DOCTYPE html>
<html lang="en">
{% include 'header.html' %}
<body>
<div id="segment_id">
    {% include 'menu.html' %}
    <div class="ui grid">
        <div class="ui column" style="width: 75px; padding-top: 50px;">
            {% include 'project/sidebar.html' %}
        </div>
        <div class="ui column" style="width: calc(100% - 75px)">
            <h1 class="ui dividing header">Reports</h1>
            <script>
                $(document).ready(function () {
                    $('.ui.dropdown')
                        .dropdown({
                            fullTextSearch: "exact"
                        })
                    ;

                    $('.message .close')
                        .on('click', function () {
                            $(this)
                                .closest('.message')
                                .transition('fade')
                            ;
                        });
                });
            </script>
            <div class="ui container" style="width: 100%">
                <div class="ui grid">
                    <div class="ui eight wide column">
                        <h2 class="ui dividing header" style="width: 50%"><i class="plus icon"></i>Create a report</h2>
                        <form class="ui form" style="max-width:50%" enctype="multipart/form-data" data-name="Email Form"
                              method="post" action="/project/{{ current_project['id'] }}/reports/generate">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                            <div class="ui field">
                                <select class="ui dropdown" name="template_id">
                                    <option value="">Saved template</option>
                                    {% for team in db.select_user_teams(current_user['id']) %}
                                        {% for template in db.select_templates(team_id=team['id']) %}
                                            <option value="{{ template['id'] }}">{{ escape(team['name']) }}
                                                - {{ escape(template['name']) }}</option>
                                        {% endfor %}
                                    {% endfor %}
                                    {% for template in db.select_templates(user_id=current_user['id']) %}
                                        <option value="{{ template['id'] }}">
                                            (private) {{ escape(template['name']) }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <label>or upload zip/doc(x)/plaintext file </label>
                            <div class="ui field">
                                <label for="file" class="ui icon button" style="margin-bottom: 15px; width: 100px;">
                                    <i class="file icon"></i>
                                    Open File</label>
                                <input type="file" id="file" name="file" style="display:none">
                            </div>
                            <label>Template files' extentions (for .zip templates)</label>
                            <div class="ui field">
                                <div class="ui input">
                                    <input type="text" name="extentions" placeholder="txt/tex/html/...">
                                </div>
                            </div>
                            <button class="ui button blue" type="submit" value="Download">
                                <i class="ui download icon"></i>Download
                            </button>
                            {% if errors is defined and errors %}
                                <div class="ui error message visible">
                                    <i class="close icon"></i>
                                    <div class="header">
                                        There were some errors with project creation:
                                    </div>
                                    <ul class="list">
                                        {% for error in errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endif %}
                            {% if exception is defined and exception != '' %}
                                <div class="ui error message visible">
                                    <i class="close icon"></i>
                                    <div class="header">
                                        Exception during runtime:
                                    </div>
                                    <ul class="list">
                                        {% for error in errors %}
                                            <li>{{ exception }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endif %}
                        </form>
                    </div>
                    <div class="ui eight wide column">
                        <h2 class="ui dividing header"><i class="history icon"></i>History</h2>
                    </div>
                </div>
            </div>
        </div>
        {% include 'footer.html' %}
    </div>
</div>
</body>
</html>