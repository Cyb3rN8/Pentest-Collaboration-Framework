<!DOCTYPE html>
<html lang="en">
{% include 'header.html' %}
<body>
<div id="segment_id">
    {% include 'menu.html' %}
    <div class="ui grid">
        <div class="ui column" style="width: 75px; padding-top: 50px;">
            {% include 'project/sidebar.html' %}
        </div>
        <script>
            $(document).ready(function () {
                var table = $('#creds_list').DataTable({
                    "order": [[1, "asc"]],
                    "iDisplayLength": 10,
                    aLengthMenu: [
                        [10, 25, 50, 100, 200, -1],
                        [10, 25, 50, 100, 200, "All"]
                    ],
                    'columnDefs': [{
                        'targets': 3,
                        'searchable': false,
                        'orderable': false,
                    }],
                    "initComplete": function (settings, json) {
                        div_block = $('#creds_list_length')[0];
                        div_block.innerHTML = div_block.innerHTML + '<a style="margin-left: 15px;" class="ui vertical animated button blue" tabindex="0" href="/project/{{current_project['id']}}/credentials/new_creds">' +
                            '<div class="hidden content">Add</div>' +
                            '<div class="visible content">' +
                            '<i class="plus icon"></i></div></a>' +
                            '<a style="margin-left: 15px; width:100px;" class="ui vertical animated button purple" tabindex="0" href="/project/{{current_project['id']}}/credentials/import_creds">' +
                            '<div class="hidden content">Multiple add</div>' +
                            '<div class="visible content">' +
                            '<i class="users icon"></i></div></a>'
                    }
                });
            });
        </script>
        <style>
            tr.odd {
                background-color: #fffdc2;
            }

            tr.even {
                background-color: #c3ffcd;
            }

            .ui.menu:last-child {
                margin-bottom: 0px;
            }
        </style>
        <div class="ui column" style="width: calc(100% - 75px)">
            {% set creds_array = db.select_project_creds(current_project['id']) %}
            <h1 class="ui dividing header">Credentials: {{ len(creds_array) }}</h1>
            <div class="ui container" style="width: 100%">
                <table id="creds_list" class="ui table">
                    <thead>
                    <tr id="table_header">
                        <th><h4>login / email</h4></th>
                        <th><h4>hash</h4></th>
                        <th><h4>password</h4></th>
                        <th><h4>comment</h4></th>
                        <th><h4>service</h4></th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for current_cred in creds_array %}
                        <tr>
                            <td>
                                <a href="/project/{{ current_project['id'] }}/credentials/{{ current_cred['id'] }}/"
                                   class="link-2">{{ current_cred['login'] }}</a>
                            </td>
                            <td>
                                <div class="text-block-31"
                                     style="word-break: break-all; white-space:pre-wrap;">{{ current_cred['hash'] }}</div>
                            </td>
                            <td>
                                <div class="text-block-31"
                                     style="word-break: break-all; white-space:pre-wrap;">{{ current_cred['cleartext'] }}</div>
                            </td>
                            <td>
                                <div class="text-block-31"
                                     style="word-break: break-all; white-space:pre-wrap;">{{ current_cred['description'] }}</div>
                            </td>
                            <td>
                                <ul class="ui list">
                                    {% set addresses = json_unpack(current_cred['services']) %}
                                    {% for port_id in addresses %}
                                        {% set port = db.select_port(port_id)[0] %}
                                        {% for host in addresses[port_id] %}
                                            {% if host=="0" %}
                                                {% set ip = db.select_host_by_port_id(port_id)[0] %}
                                                <li>{{ escape(ip['ip']) }}{% if port['port'] != 0 %}:{{ escape(port['port']) }}{% endif %}</li>
                                            {% else %}
                                                {% set hostname = db.select_hostname(host)[0] %}
                                                <li>{{ escape(hostname['hostname']) }}{% if port['port'] != 0 %}:{{ escape(port['port']) }}{% endif %}</li>
                                            {% endif %}
                                        {% endfor %}
                                    {% endfor %}
                                </ul>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% include 'footer.html' %}
    </div>
</div>
</body>
</html>