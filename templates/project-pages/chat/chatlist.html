<!DOCTYPE html>
<!--  This site was created in Webflow. http://www.webflow.com  -->
<!--  Last Published: Sun Aug 16 2020 15:12:58 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="5eef5b1e15495855fd04886f" data-wf-site="5ec2ba8457c5c50b20b387c9">
{% include 'header.html' %}
<body>
  {% include 'navbar.html' %}
  <div class="columns-43 w-row">
    {% include 'project-pages/menu.html' %}
    <div class="column w-col w-col-11">
      <div class="w-row">
        <div class="w-clearfix w-col w-col-6">
          <h1 class="heading-3">Chats</h1>
        </div>
        <div class="w-col w-col-6">
          <div class="form-block-9 w-form">
            <form id="email-form-2" name="email-form-2" data-name="Email Form 2" action="/project/{{current_project['id']}}/chats/add" method="post">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
              <div class="w-row">
                <div class="w-clearfix w-col w-col-10">
                    <input type="text" class="text-field-13 w-input" maxlength="256" name="name" data-name="Name" placeholder="name of chat" id="name" required="">
                </div>
                <div class="w-col w-col-2">
                    <input type="submit" value="Add" data-wait="Please wait..." class="submit-button-16 w-button">
                </div>
              </div>
            </form>
            <div class="w-form-done">
              <div>Thank you! Your submission has been received!</div>
            </div>
            <div class="w-form-fail">
              <div>Oops! Something went wrong while submitting the form.</div>
            </div>
          </div>
        </div>
      </div>

      <div data-duration-in="300" data-duration-out="100" class="tabs-6 w-tabs">
        <div class="tabs-menu-4 w-clearfix w-tab-menu">
          {% set chats_arr = db.select_project_chats(current_project['id']) %}
          {% for current_chat in chats_arr %}
          <a data-w-tab="Chat {{current_chat['id']}}" class="tab-link-tab-1-2 w-inline-block w-tab-link">
            <div class="text-block-32">{{escape(current_chat['name'])}}</div>
          </a>
          {% endfor %}
        </div>
        <div class="tabs-content-3 w-tab-content">
          {% for current_chat in chats_arr %}
          <div data-w-tab="Chat {{current_chat['id']}}" class="tab-pane-tab-1-2 w-clearfix w-tab-pane">


              <section class="msger" id="{{current_chat['id']}}">
                  <header class="msger-header">
                    <div class="msger-header-title">
                      <i class="fas fa-comment-alt"></i> SimpleChat
                    </div>
                    <div class="msger-header-options">
                      <span><i class="fas fa-cog"></i></span>
                    </div>
                  </header>

                  <main class="msger-chat" id="{{current_chat['id']}}">
                    <div class="msg left-msg">
                      <div class="msg-img" style="background-image: url(/static/images/145867.svg)"></div>
                      <div class="msg-bubble">
                        <div class="msg-info">
                          <div class="msg-info-name">Pentest Collab Framework</div>
                          <div class="msg-info-time">13:37</div>
                        </div>

                        <div class="msg-text">
                          Hi, welcome to new chat (based on SimpleChat)! ðŸ˜„
                        </div>
                      </div>
                    </div>

                  </main>
                  <form class="msger-inputarea" id="{{current_chat['id']}}">
                    <input type="hidden" name="chat_id" value="{{current_chat['id']}}">
                    <input type="text" class="msger-input" placeholder="Enter your message...">
                    <button type="submit" class="msger-send-btn">Send</button>
                  </form>
                </section>

          </div>

          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  <script src="/static/js/chats.js"></script>
  {% include 'footer.html' %}
  <!-- get all chats messages -->

  <script>
    let current_user_email = '{{current_user["email"]}}';
    let csrf_token = '{{ csrf_token() }}';
    let chats_array = [
      {% for chat_id in db.select_project_chats(current_project['id'], js=True) %}
          "{{chat_id}}",
      {% endfor %}
    ];


    //get all messages
    for (let i = 0; i < chats_array.length; i++) {
      let chat_id = chats_array[i];
      setInterval(check_new_messages, 3000, chat_id, current_user_email, chat_last_time);
    }

  </script>

</body>
</html>