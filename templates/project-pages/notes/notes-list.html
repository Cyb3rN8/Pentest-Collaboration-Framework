<!DOCTYPE html>
<!--  This site was created in Webflow. http://www.webflow.com  -->
<!--  Last Published: Mon Jul 06 2020 16:48:25 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="5eee6a0cbfcf6a0de53efa6a" data-wf-site="5ec2ba8457c5c50b20b387c9">
{% include 'header.html' %}
<body>
  {% include 'navbar.html' %}
  <div class="columns-43 w-row">
    {% include 'project-pages/menu.html' %}
    <style>
        .ck-editor__editable_inline {
            height: 400px;
        }
    </style>
    <script>
      var editor_array = [''];
      function submitnote(number, note_id, action){
          if (action=='Delete'){
            if (delete_prompt(this,'Are you sure to delete note?') == false){
              return false;
            }
          }
          $.ajax({
              url: '/project/{{current_project['id']}}/notes/edit',
              type: 'post',
              async: false,
              cache: false,
              data: {
                'csrf_token': '{{ csrf_token() }}',
                'note_id': note_id,
                'action': action,
                'text': editor_array[number].getData()
              },
              success: function (data) {
              }
            });
          if (action=='Delete'){
            setTimeout(function(){}, 3000);
            window.location.reload(true);
          }
      }
    </script>
    <div class="column w-col w-col-11">
      <div class="w-row">
        <div class="w-clearfix w-col w-col-6">
          <h1 class="heading-3">Notes</h1>
        </div>
        <div class="w-col w-col-6">
          <div class="form-block-9 w-form">
            <form id="email-form-2" name="email-form-2" data-name="Email Form 2" action="/project/{{current_project['id']}}/notes/add" method="post">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
              <div class="w-row">
                <div class="w-clearfix w-col w-col-10">
                  <input type="text" class="text-field-13 w-input" maxlength="256" name="name" data-name="name" placeholder="name of note" id="name-2" required="">
                </div>
                <div class="w-col w-col-2">
                  <input type="submit" value="Add" data-wait="Please wait..." class="submit-button-16 w-button">
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div data-duration-in="300" data-duration-out="100" class="tabs-6 w-tabs">
        <div class="tabs-menu-4 w-clearfix w-tab-menu">

          {% set notes_arr = db.select_project_notes(current_project['id']) %}

          {% for current_note in notes_arr %}

          <a data-w-tab="Note {{loop.index}}" class="tab-link-tab-1-2 w-inline-block w-tab-link">
            <div class="text-block-32">{{escape(current_note['name'])}}</div>
          </a>

          {% endfor %}
        </div>
        <div class="tabs-content-3 w-tab-content">

          <!-- -->

          {% for current_note in notes_arr %}

          <div data-w-tab="Note {{loop.index}}" class="tab-pane-tab-1-2 w-tab-pane">
            <div class="form-block-8 w-form" id="note-{{loop.index}}" >
              <form id="note-form-{{loop.index}}" name="email-form" data-name="Email Form" class="form-6" action="/project/{{current_project['id']}}/notes/edit" method="post">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <input type="hidden" name="note_id" value="{{ escape(current_note['id']) }}"/>
                <div class="div-block-11 w-clearfix">
                  <div class="div-block-17">
                    <textarea id="editor_{{loop.index}}" name="text" style="height: 500px">
                      {{escape(current_note['text'])}}
                    </textarea>
                  </div>
                  <label class="w-checkbox checkbox-field-10">
                    <input type="checkbox" id="checkbox-{{loop.index}}" name="checkbox" data-name="Checkbox" class="w-checkbox-input">
                    <span class="w-form-label">Autosave (15 seconds)</span>
                  </label>
                  <button name="action" type="button" value="Update" data-wait="Please wait..." class="button-40 w-button" onclick="submitnote({{loop.index}}, '{{current_note['id']}}', 'Update');">Update</button>
                  <button name="action" type="button" value="Delete" class="button-32 w-button" onclick="submitnote({{loop.index}}, '{{current_note['id']}}', 'Delete');">Delete</button>
                </div>
              </form>
              <script>
                ClassicEditor
                        .create( document.querySelector( '#editor_{{loop.index}}' ) )
                        .then(editor => {
                              editor_array.push(editor);
                          } )
                        .catch( error => {
                          console.error( error );
                        } );
                function autosubmit_{{loop.index}}() {
                  if ($('#checkbox-{{loop.index}}').is(":checked")){
                    submitnote( {{loop.index}}, '{{current_note['id']}}', 'Update');
                  }
                }
                var interval = setInterval(autosubmit_{{loop.index}}, 15000);

              </script>
            </div>
          </div>

          <!-- -->
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  {% include 'footer.html' %}
</body>
</html>