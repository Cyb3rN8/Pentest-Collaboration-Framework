<!DOCTYPE html>
<!--  This site was created in Webflow. http://www.webflow.com  -->
<!--  Last Published: Mon Jul 06 2020 16:48:25 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="5eecbd0654b70280a91b25d4" data-wf-site="5ec2ba8457c5c50b20b387c9">
{% include 'header.html' %}
<body>
  {% include 'navbar.html' %}
  <div class="columns w-row">
    {% include 'project-pages/menu.html' %}
    <div class="column w-clearfix w-col w-col-11">
      <h1 class="heading-3">Project files</h1>
      <div class="w-row">
        <div class="column-172 w-col w-col-2">
          <div class="text-block-8">filename</div>
        </div>
        <div class="column-173 w-col w-col-5">
          <div class="text-block-8">description</div>
        </div>
        <div class="column-174 w-col w-col-3">
          <div class="text-block-8">services</div>
        </div>
        <div class="column-175 w-col w-col-2"></div>
      </div>


      <!-- -->

      {% set files = db.select_project_files(current_project['id']) %}

      {% for current_file in files %}
          {% if loop.index % 2 == 0 %}
          <div class="columns-37 w-row">
          {% else %}
          <div class="columns-38 w-row">
          {% endif %}
            <div class="column-176 w-col w-col-2">
              <div class="text-block-29" style="word-break: break-all; white-space:pre-wrap;">{{escape(current_file['filename'])}}<br></div>
            </div>
            <div class="column-177 w-col w-col-5">
              <div class="text-block-29" style="word-break: break-all; white-space:pre-wrap;">{{escape(current_file['description'])}}</div>
            </div>
            <div class="column-178 w-col w-col-3">
              {% set addresses = json_unpack(current_file['services']) %}
              {% for port_id in addresses %}
                  {% set port = db.select_port(port_id)[0] %}
                  {% for host in addresses[port_id] %}
                      {% if host=="0" %}
                          {% set ip = db.select_host_by_port_id(port_id)[0] %}
                          <div class="text-block-29">{{escape(ip['ip'])}}:{{escape(port['port'])}}</div>
                      {% else %}
                          {% set hostname = db.select_hostname(host)[0] %}
                          <div class="text-block-29">{{escape(hostname['hostname'])}}:{{escape(port['port'])}}</div>
                      {% endif %}
                  {% endfor %}
              {% endfor %}
            </div>
            <div class="column-179 w-col w-col-2">
              {% if current_file['type']=='binary' %}
                    <a href="/static/files/code/{{current_file['id']}}" class="button-33 w-button">Download</a>
              {% else %}
                    <a href="/project/{{current_project['id']}}/files/{{current_file['id']}}/" class="button-27 w-button">View</a>
              {% endif %}
              <form action="/project/{{current_project['id']}}/files/{{current_file['id']}}/" method="post" onsubmit="return delete_prompt(this,'Are you sure to delete file {{escape(current_file['filename'])}}?')">
                  <input type="hidden" name="action" value="delete">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                  <button type="submit" class="button-26 w-button">Delete</button>
              </form>
            </div>
          </div>

      {% endfor %}

      <!-- -->
      <div class="w-form">
        <form id="email-form" name="email-form" data-name="Email Form" enctype="multipart/form-data" action="/project/{{current_project['id']}}/files/new" method="post">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
          <div class="columns-40 w-row">
            <div class="w-col w-col-2">
              <input type="file" class="text-field-6 w-input" maxlength="256" name="file" data-name="File" placeholder="File input field" id="File" required="">
            </div>
            <div class="w-col w-col-5">
              <input type="text" class="text-field-7 w-input" maxlength="256" name="description" data-name="description" placeholder="Example description" id="description">
            </div>
            <div class="column-188 w-col w-col-3">
              <div class="div-block-10">
                {% set hosts = db.select_project_hosts(current_project['id']) %}
                {% set count = [1] %}
                {% for current_host in hosts %}
                    {% set ports = db.select_host_ports(current_host['id']) %}
                    {% set hostnames = db.select_ip_hostnames(current_host['id']) %}
                    {% for current_port in ports %}
                        {% if count.append(count.pop() + 1) %}{% endif %}
                        <label class="w-checkbox">
                          <input type="checkbox" id="checkbox" name="ip_port-{{count[0]}}" value="{{current_port['id']}}" data-name="Checkbox" class="w-checkbox-input">
                          <span class="w-form-label">{{current_host['ip']}}:{{current_port['port']}}</span>
                        </label>
                    {% endfor %}
                    {% for current_port in ports %}
                        {% for current_hostname in hostnames %}
                            {% if count.append(count.pop() + 1) %}{% endif %}
                            <label class="w-checkbox">
                              <input type="checkbox" id="checkbox" name="host_port-{{count[0]}}" value="{{current_port['id']}}:{{current_hostname['id']}}" data-name="Checkbox" class="w-checkbox-input">
                              <span class="w-form-label">{{current_hostname['hostname']}}:{{current_port['port']}}</span>
                            </label>
                        {% endfor %}
                    {% endfor %}
                {% endfor %}
              </div>
            </div>
            <div class="w-clearfix w-col w-col-2">
              <select id="field" name="filetype" class="select-field-4 w-select">
                <option value="binary">Binary file</option>
                <option value="text">Text file</option>
                <option value="image">Image</option>
              </select>
              <input type="submit" value="Submit" data-wait="Please wait..." class="submit-button-13 w-button">
            </div>
          </div>
        </form>
        {% if errors is defined and errors != [] %}
            {% for error in errors %}
              <div class="error-message w-form-fail" style="display: block">
                  <div>{{error}}</div>
              </div>
            {% endfor %}
        {% endif %}
      </div>
    </div>
  </div>
 {% include 'footer.html' %}
</body>
</html>