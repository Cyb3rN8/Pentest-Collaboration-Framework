<!DOCTYPE html>
<!--  This site was created in Webflow. http://www.webflow.com  -->
<!--  Last Published: Mon Jul 13 2020 22:20:45 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="5ece8af46b1649e2a518d467" data-wf-site="5ec2ba8457c5c50b20b387c9">
{% include 'header.html' %}
<body>
  {% include 'navbar.html' %}
  <div class="columns w-row">
    {% include 'project-pages/menu.html' %}
    <div class="column w-clearfix w-col w-col-11">
      <h1 class="heading-3">Edit network</h1>
      <div class="form-block-3 w-form">
        <form id="email-form" name="email-form" data-name="Email Form" class="form" method="post" action="/project/{{current_project['id']}}/networks/{{ current_network['id'] }}/edit" onsubmit="return delete_prompt(this,'Are you sure to edit/delete network?')">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div class="w-row">
                <div class="w-clearfix w-col w-col-6">
                    <label for="ip-2" class="field-label">IP-address</label>
                    <input type="text" class="text-field w-input" maxlength="256" name="ip" data-name="ip" placeholder="127.0.0.1" id="ip-2" required="" value="{{ current_network['ip'] }}">
                    <label for="mask" class="field-label">Mask</label>
                    <input type="number" class="text-field w-input" maxlength="256" name="mask" data-name="mask" placeholder="24" id="mask" required="" value="{{ current_network['mask'] }}">
                    <label for="mask-3" class="field-label">Internal IP</label>
                    <input type="text" class="text-field w-input" maxlength="256" name="internal_ip" data-name="internal_ip" placeholder="10.0.2.15" id="mask-3" value="{{ escape(current_network['internal_ip']) }}">
                    <label for="mask-2" class="field-label">ASN</label>
                    <input type="number" class="text-field w-input" maxlength="256" name="asn" data-name="Mask 2" placeholder="1337" id="mask-2" value="{{ current_network['asn'] }}">
                    <label for="Description" class="field-label-3">Comment</label>
                    <textarea placeholder="Network description" maxlength="5000" id="Description" name="comment" data-name="Description" class="textarea w-input">{{ escape(current_network['comment']) }}</textarea>
                    <label for="Description-2" class="field-label-3">Connection command</label>
                    <textarea placeholder="ssh -D 8888 root@localhost" maxlength="5000" id="Description-2" name="cmd" data-name="cmd" class="textarea w-input">{{ escape(current_network['cmd']) }}</textarea>
                    <input type="submit" value="Update" data-wait="Please wait..." class="submit-button-40 w-button">
                    <input type="submit" value="Delete" data-wait="Please wait..." class="submit-button-41 w-button">
                </div>
                <div class="w-clearfix w-col w-col-6">
                      <label for="ip-3" class="field-label">Access from...</label>
                      <div class="columns-51 w-row">
                          <div class="column-226 w-col w-col-6" style="height: 450px">
                              <input type="text" placeholder="ip" id="ip_input">
                              <div style="max-height: 420px; overflow: auto">
                              {% set hosts = db.select_project_hosts(current_project['id']) %}
                              {% set network_js = json_unpack(current_network['access_from']) %}
                              {% set count = [1] %}
                              {% for host in hosts %}
                                  {% set ports = db.select_host_ports(host['id'],full=True) %}
                                  {% for port in ports %}
                                      {% if count.append(count.pop() + 1) %} {% endif %}
                                      <label class="w-checkbox" id="ip_row">
                                          <input type="checkbox" id="checkbox-10" name="ip_port-{{count[0]}}" data-name="Checkbox 10" class="w-checkbox-input" value="{{port['id']}}" {%  if port['id'] in network_js and "0" in network_js[port['id']] %}checked{% endif %} />
                                          <span class="checkbox-label-4 w-form-label">{{escape(host['ip'])}}{% if port['port'] !=0 %}:{{port['port']}}{% if not port['is_tcp'] %} (udp) {% endif %}{% endif %}</span>
                                      </label>
                                      {% endfor %}
                              {% endfor %}
                              </div>
                          </div>
                          <div class="column-227 w-col w-col-6" style="height: 450px">
                              <input type="text" placeholder="hostname" id="hostname_input">
                              <div style="max-height: 420px; overflow: auto">
                                  {% set count = [1] %}
                                  {% for host in hosts %}
                                      {% set hostnames = db.select_ip_hostnames(host['id']) %}
                                      {% set ports = db.select_host_ports(host['id'], full=True) %}
                                      {% for hostname in hostnames %}
                                          {% for port in ports %}
                                              {% if count.append(count.pop() + 1) %} {% endif %}
                                              <label class="w-checkbox" id="hostname_row">
                                                  <input type="checkbox" id="checkbox-10" name="host_port-{{count[0]}}" data-name="Checkbox 10" class="w-checkbox-input" value="{{port['id']}}:{{hostname['id']}}"  {%  if port['id'] in network_js and hostname['id'] in network_js[port['id']] %}checked{% endif %} />
                                                  <span class="checkbox-label-6 w-form-label">{{escape(hostname['hostname'])}}{% if port['port'] !=0 %}:{{port['port']}}{% if not port['is_tcp'] %} (udp) {% endif %}{% endif %}</span>
                                              </label>
                                          {% endfor %}
                                      {% endfor %}
                                  {% endfor %}
                              </div>
						  </div>
						  <script>
							  var elements = document.querySelectorAll('[id=hostname_row]');
							  for(i=0; i<elements.length; i++) {
									is_checked = elements[i].children[0].checked;
									if ( is_checked ){
										elements[i].parentNode.prepend(elements[i]);
									} else {

									}
							  };
							  elements = document.querySelectorAll('[id=ip_row]');
							  for(i=0; i<elements.length; i++) {
									is_checked = elements[i].children[0].checked;
									if ( is_checked ){
										elements[i].parentNode.prepend(elements[i]);
									} else {

									}
							  }
                      	  </script>
                        </div>
                </div>
            </div>
        </form>
        <script>
              $('#ip_input').on('keyup', function(){
                  var $this = $(this),
                      val = $this.val();
                      var elements = document.querySelectorAll('[id=ip_row]');
                      for(var i=0; i<elements.length; i++) {
                        data = elements[i].children[1].textContent;
                        if ( (data.includes(val)) || (val === '') ){
                            elements[i].style.display = 'block';
                        } else {
                            elements[i].style.display = 'none';
                        }
                  }
              });

              $('#hostname_input').on('keyup', function(){
                  var $this = $(this),
                      val = $this.val();
                      var elements = document.querySelectorAll('[id=hostname_row]');
                      for(var i=0; i<elements.length; i++) {
                        data = elements[i].children[1].textContent;
                        if ( (data.includes(val)) || (val === '') ){
                            elements[i].style.display = 'block';
                        } else {
                            elements[i].style.display = 'none';
                        }
                  }
              })
        </script>
        {% if errors is defined and errors != [] %}
              {% for error in errors %}
                <div class="error-message w-form-fail" style="display: block">
                    <div>{{error}}</div>
                </div>
              {% endfor %}
        {% endif %}
      </div>
    </div>
  </div>
  {% include 'footer.html' %}
</body>
</html>